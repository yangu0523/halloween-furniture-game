<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼Šæ³½å°”çš„ä¸‡åœ£èŠ‚æ‰­è›‹å°å±‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes eggDrop {
            0% { top: 0; transform: translateX(-50%) rotate(0deg); }
            70% { top: 120px; transform: translateX(-50%) rotate(180deg); }
            100% { top: 100px; transform: translateX(-50%) rotate(360deg); }
        }

        @keyframes eggOpen {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
            100% { transform: translateX(-50%) scale(0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes ghost-float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-10px) translateX(5px); }
            50% { transform: translateY(-5px) translateX(-5px); }
            75% { transform: translateY(-15px) translateX(3px); }
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.7)); }
            50% { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.9)); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* æ‰­è›‹åŠ¨ç”» */
        #dropping-egg {
            animation: eggDrop 1s ease-in-out forwards;
        }

        #dropping-egg.open {
            animation: eggOpen 0.5s ease-in-out forwards;
        }

        /* å°å±‹æ ·å¼ */
        #room-container {
            position: relative;
            background-color: #f8f9fa;
            border: 8px solid #4a5568;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .room-wall {
            position: absolute;
            background-color: #e2e8f0;
            z-index: 1;
        }
        
        .room-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80%;
            background-color: #f7fafc;
            background-image: 
                linear-gradient(rgba(100,100,100,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(100,100,100,0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: 0;
        }
        
        .room-window {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 60px;
            background-color: #cbd5e0;
            border: 4px solid #4a5568;
            border-radius: 4px;
            z-index: 2;
            display: flex;
            flex-wrap: wrap;
        }
        
        .room-window::before, .room-window::after {
            content: '';
            position: absolute;
            background-color: #4a5568;
        }
        
        .room-window::before {
            width: 4px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .room-window::after {
            width: 100%;
            height: 4px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .room-door {
            position: absolute;
            bottom: 0;
            left: 20px;
            width: 60px;
            height: 100px;
            background-color: #718096;
            border: 4px solid #4a5568;
            border-radius: 4px 4px 0 0;
            z-index: 2;
        }
        
        .room-door::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 10px;
            width: 8px;
            height: 8px;
            background-color: #a0aec0;
            border-radius: 50%;
            transform: translateY(-50%);
        }
        
        .room-corner {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #4a5568;
            z-index: 2;
        }
        
        .room-corner.top-left {
            top: 0;
            left: 0;
            border-radius: 0 0 10px 0;
        }
        
        .room-corner.top-right {
            top: 0;
            right: 0;
            border-radius: 0 0 0 10px;
        }
        
        /* å®¶å…·æ ·å¼ */
        .room-furniture {
            position: absolute;
            cursor: move;
            transition: transform 0.2s ease, filter 0.2s ease;
            z-index: 5;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .room-furniture:hover {
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
        }
        
        .furniture-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* ç»˜åˆ¶åŒºåŸŸæ ·å¼ */
        #drawing-canvas {
            border: 2px dashed #4a5568;
            border-radius: 8px;
            cursor: crosshair;
            background-color: transparent;
            background-image: 
                linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-btn.active {
            background-color: #4a5568;
            color: white;
        }

        .pixel-preview {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            margin-left: 10px;
        }

        /* é¡µé¢æ ·å¼ */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: #4a5568;
        }
        
        .nav-btn.active {
            background-color: #4a5568;
            color: white;
        }
        
        .nav-btn:hover:not(.active) {
            background-color: #e9ecef;
        }

        /* æŒ‰é’®æ¿€æ´»çŠ¶æ€ */
        button.active {
            background-color: #4a5568;
            color: white;
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        #music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            font-size: 20px;
            color: #4a5568;
        }
        
        /* ç¨€æœ‰åº¦ç‰¹æ•ˆ */
        .rarity-rare {
            animation: glow 3s infinite;
        }
        
        .rarity-epic {
            animation: glow 2s infinite;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.7));
        }
        
        .rarity-legendary {
            animation: glow 1s infinite;
            filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.9));
        }

        /* è¯„åˆ†æ˜Ÿæ˜Ÿ */
        .star {
            color: #ffc107;
            font-size: 24px;
        }
        
        /* è´´çº¸æ ·å¼ */
        .sticker {
            position: absolute;
            cursor: move;
            user-select: none;
            z-index: 100;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: transform 0.2s;
            font-size: 2rem;
        }

        .sticker:hover {
            transform: scale(1.05);
        }
        
        /* å¹½çµåŠ¨ç”» */
        .ghost {
            position: absolute;
            width: 50px;
            height: 70px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50% 50% 10px 10px;
            animation: ghost-float 10s infinite ease-in-out;
            z-index: 10;
        }
        
        .ghost::before, .ghost::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #4a5568;
            border-radius: 50%;
            top: 15px;
        }
        
        .ghost::before { left: 10px; }
        .ghost::after { right: 10px; }
        
        .ghost .mouth {
            position: absolute;
            width: 15px;
            height: 5px;
            background-color: #4a5568;
            border-radius: 3px;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* å°æ¸¸æˆæ ·å¼ */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: white;
            z-index: 100;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #game-selection {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .game-option {
            width: 250px;
            height: 100px;
            background-color: #f5f5f5;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .game-option:hover {
            background-color: #e8eaf6;
            transform: translateY(-5px);
            border-color: #4a5568;
        }

        .game-icon {
            font-size: 32px;
        }

        .game-info {
            text-align: left;
        }

        .game-title {
            font-weight: bold;
            font-size: 18px;
        }

        .game-reward {
            font-size: 14px;
            color: #666;
        }

        #game-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #4b5563;
        }
        
        /* æŠ–åŠ¨ä¿®æ­£æŒ‡ç¤ºå™¨ */
        #stabilizer {
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: rgba(255, 0, 0, 0.7);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
            display: none;
        }
        
        /* å°æ¸¸æˆæ ·å¼ */
        .game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .game-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .game-description {
            font-size: 16px;
            color: #666;
        }
        
        #match-game {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 5px;
            width: 300px;
            height: 300px;
        }
        
        .game-tile {
            background-color: #e2e8f0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .game-tile:hover {
            background-color: #cbd5e0;
        }
        
        #memory-game {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 10px;
            width: 400px;
            height: 400px;
        }
        
        .memory-card {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        
        .memory-card .front,
        .memory-card .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .memory-card .front {
            background-color: #4a5568;
            color: white;
            transform: rotateY(180deg);
        }
        
        .memory-card .back {
            background-color: #e2e8f0;
            color: #4a5568;
        }
        
        #pumpkin-game {
            position: relative;
            width: 300px;
            height: 400px;
            background-color: #f7fafc;
            border: 2px solid #4a5568;
            border-radius: 5px;
            overflow: hidden;
        }
        
        #pumpkin-basket {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 30px;
            background-color: #718096;
            border-radius: 5px;
        }
        
        .falling-pumpkin {
            position: absolute;
            top: -30px;
            font-size: 24px;
            animation-name: fall;
            animation-timing-function: linear;
        }
        
        @keyframes fall {
            to { top: 100%; }
        }
        
        .game-controls {
            display: flex;
            gap: 10px;
        }
        
        .game-button {
            padding: 8px 16px;
            background-color: #4a5568;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .game-button:hover {
            background-color: #2d3748;
        }
        
        .game-result {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        #game-score {
            font-size: 18px;
            font-weight: bold;
        }
        
        #pumpkin-instruction {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        
        /* å›¾ç‰‡ä¸Šä¼ æ ·å¼ */
        .upload-container {
            max-w-2xl mx-auto mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 text-center;
        }
        
        .upload-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #4a5568;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 8px 16px;
            background-color: #4a5568;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-bottom: 10px;
        }
        
        .upload-btn:hover {
            background-color: #2d3748;
        }
        
        #image-upload {
            display: none;
        }
        
        .upload-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .upload-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 10px auto;
            display: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }
        
        .upload-actions {
            margin-top: 15px;
            display: none;
        }
        
        .upload-confirm {
            padding: 6px 12px;
            background-color: #48bb78;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .upload-cancel {
            padding: 6px 12px;
            background-color: #f56565;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: bounceIn 0.5s;
        }
        
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .modal-confirm {
            background-color: #48bb78;
            color: white;
            border: none;
        }
        
        .modal-cancel {
            background-color: #f56565;
            color: white;
            border: none;
        }

        /* è·å¾—ç‰©å“å¼¹çª—æ ·å¼ */
        .reward-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .reward-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: bounceIn 0.6s;
        }
        
        .reward-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: float 3s infinite;
        }
        
        .reward-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4a5568;
        }
        
        .reward-name {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .reward-description {
            font-size: 14px;
            color: #718096;
            margin-bottom: 20px;
        }
        
        .reward-close {
            padding: 10px 20px;
            background-color: #4a5568;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .reward-close:hover {
            background-color: #2d3748;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans overflow-x-hidden">
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="background-music" loop>
        <source src="https://music.163.com/song/media/outer/url?id=2723079010.mp3" type="audio/mpeg">
    </audio>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div id="music-control" class="text-gray-700">
        <i class="fa fa-music"></i>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-sm fixed top-0 left-0 w-full z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fa fa-pumpkin-o text-gray-700 text-2xl"></i>
                <h1 class="text-xl font-bold">ä¼Šæ³½å°”çš„ä¸‡åœ£èŠ‚æ‰­è›‹å°å±‹</h1>
            </div>
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-1">
                    <i class="fa fa-gift text-gray-700"></i>
                    <span id="egg-count" class="font-medium">10</span>
                </div>
                <div class="flex items-center gap-1">
                    <i class="fa fa-star-o text-gray-700"></i>
                    <span id="furniture-count" class="font-medium">0/50</span>
                </div>
                <div class="flex items-center gap-1">
                    <i class="fa fa-sticky-note text-gray-700"></i>
                    <span id="sticker-count" class="font-medium">0</span>
                </div>
            </div>
        </div>
        
        <!-- åˆ†é¡µå¯¼èˆª -->
        <div class="container mx-auto px-4 py-2 flex justify-center gap-2">
            <button class="nav-btn active" data-page="gacha">æ‰­è›‹æœº</button>
            <button class="nav-btn" data-page="drawing">ç»˜åˆ¶å®¶å…·</button>
            <button class="nav-btn" data-page="room">æˆ‘çš„å°å±‹</button>
            <button class="nav-btn" data-page="stickers">è´´çº¸è£…é¥°</button>
            <button class="nav-btn" data-page="collection">å®¶å…·æ”¶è—</button>
            <button class="nav-btn" data-page="games">å°æ¸¸æˆ</button>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 pt-32 pb-16">
        <!-- 1. æ‰­è›‹æœºé¡µé¢ -->
        <section id="gacha" class="page active">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold mb-2">ä¸‡åœ£èŠ‚æ‰­è›‹æœº</h2>
                <p class="text-gray-500">æ¶ˆè€—æ‰­è›‹ï¼Œè·å–éšæœºé£æ ¼å®¶å…·æˆ–è´´çº¸</p>
            </div>
            
            <!-- æ‰­è›‹æœºå®¹å™¨ -->
            <div class="relative w-64 h-96 mx-auto">
                <!-- æ‰­è›‹æœºä¸»ä½“ -->
                <div class="w-full h-full bg-white border-4 border-gray-800 rounded-t-2xl relative overflow-hidden">
                    <!-- æ‰­è›‹æœºçª—å£ -->
                    <div class="absolute top-8 left-1/2 -translate-x-1/2 w-48 h-48 bg-gray-100 border-2 border-gray-700 rounded-lg overflow-hidden">
                        <div id="egg-container" class="w-full h-full flex items-center justify-center">
                            <!-- å¾…æ‰­è›‹ -->
                            <div id="waiting-egg" class="w-20 h-20 bg-gray-300 rounded-full border-2 border-gray-600 flex items-center justify-center cursor-pointer hover:bg-gray-400 transition-colors">
                                <i class="fa fa-paint-brush text-gray-700 text-2xl"></i>
                            </div>
                            <!-- æ‰­è›‹æ‰è½åŠ¨ç”»å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                            <div id="egg-drop-container" class="absolute inset-0 hidden">
                                <div id="dropping-egg" class="w-20 h-20 bg-gray-300 rounded-full border-2 border-gray-600 absolute top-0 left-1/2 -translate-x-1/2"></div>
                            </div>
                            <!-- ç»“æœå±•ç¤ºå®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                            <div id="result-show" class="absolute inset-0 hidden flex items-center justify-center">
                                <div id="result-content" class="w-32 h-32 flex items-center justify-center"></div>
                            </div>
                        </div>
                    </div>
                    <!-- æ‰­è›‹æœºæŒ‰é’® -->
                    <div id="gacha-btn" class="absolute bottom-8 left-1/2 -translate-x-1/2 w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center cursor-pointer hover:bg-gray-800 transition-colors">
                        <i class="fa fa-refresh text-white text-2xl"></i>
                    </div>
                    <!-- è£…é¥°å…ƒç´  -->
                    <div class="absolute top-4 right-4 w-8 h-8 animate-bounce">
                        <i class="fa fa-bat text-gray-700 text-xl"></i>
                    </div>
                    <div class="absolute bottom-4 left-4 w-8 h-8">
                        <i class="fa fa-spider-web text-gray-700 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- æŠ½å¡æç¤º -->
            <div class="text-center mt-4 text-gray-500">
                <p id="gacha-tip">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ‰­è›‹ï¼Œæ¯æ¬¡æ¶ˆè€—1ä¸ªæ‰­è›‹</p>
            </div>
        </section>

        <!-- 2. ç»˜åˆ¶åŒºåŸŸé¡µé¢ -->
        <section id="drawing" class="page">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold mb-2">åˆ›æ„ç»˜åˆ¶</h2>
                <p class="text-gray-500">æ ¹æ®ä¸»é¢˜ç»˜åˆ¶ä½ çš„å®¶å…·ï¼Œè·å¾—è¯„åˆ†å’Œå¥–åŠ±</p>
            </div>
            
            <!-- å½“å‰ä¸»é¢˜ -->
            <div class="max-w-2xl mx-auto mb-6 p-4 bg-white rounded-lg shadow-sm">
                <h3 class="text-lg font-semibold mb-2">å½“å‰ç»˜åˆ¶ä¸»é¢˜</h3>
                <p id="drawing-theme" class="text-gray-700">è¯·å…ˆæŠ½å–ä¸€ä¸ªç»˜åˆ¶ä¸»é¢˜</p>
                <p id="drawing-desc" class="text-sm text-gray-500 mt-1"></p>
            </div>
            
            <!-- ç»˜åˆ¶å·¥å…· -->
            <div class="max-w-2xl mx-auto mb-4">
                <div class="flex justify-center gap-4 mb-4 flex-wrap">
                    <div class="tool-btn active" data-tool="pen" title="åƒç´ ç”»ç¬”">
                        <i class="fa fa-pencil"></i>
                    </div>
                    <div class="tool-btn" data-tool="bucket" title="æ²¹æ¼†æ¡¶">
                        <i class="fa fa-tint"></i>
                    </div>
                    <div class="tool-btn" data-tool="eraser" title="æ©¡çš®æ“¦">
                        <i class="fa fa-eraser"></i>
                    </div>
                    <div class="tool-btn" data-tool="shape" title="å›¾å½¢ç¬”åˆ·">
                        <i class="fa fa-square"></i>
                    </div>
                    <div class="flex items-center gap-2">
                        <span>ç²—ç»†:</span>
                        <input type="range" id="brush-size" min="1" max="10" value="1" class="w-24">
                        <span id="brush-size-value">1px</span>
                    </div>
                    <input type="color" id="brush-color" value="#000000" class="w-10 h-10 rounded border">
                    <div class="flex items-center">
                        <span>é¢œè‰²é¢„è§ˆ:</span>
                        <div id="color-preview" class="pixel-preview" style="background-color: #000000;"></div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span>æŠ–åŠ¨ä¿®æ­£:</span>
                        <input type="range" id="stabilizer-level" min="0" max="10" value="3" class="w-24">
                        <span id="stabilizer-value">3</span>
                    </div>
                    <button id="undo-btn" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors" title="æ’¤å›">
                        <i class="fa fa-undo"></i>
                    </button>
                    <button id="clear-canvas" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                        æ¸…ç©ºç”»å¸ƒ
                    </button>
                </div>
                <!-- å›¾å½¢é€‰æ‹© -->
                <div id="shape-selector" class="flex justify-center gap-2 mb-4 hidden">
                    <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50" data-shape="rectangle">çŸ©å½¢</button>
                    <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50" data-shape="circle">åœ†å½¢</button>
                    <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50" data-shape="triangle">ä¸‰è§’å½¢</button>
                    <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50" data-shape="star">æ˜Ÿæ˜Ÿ</button>
                </div>
            </div>
            
            <!-- ç»˜åˆ¶åŒºåŸŸ -->
            <div class="max-w-2xl mx-auto relative">
                <canvas id="drawing-canvas" width="320" height="320"></canvas>
                <div id="stabilizer"></div>
            </div>
            
            <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-container">
                <h3 class="upload-title">ä¸æƒ³ç»˜åˆ¶ï¼Ÿå¯ä»¥ç›´æ¥ä¸Šä¼ å®¶å…·å›¾ç‰‡</h3>
                <label for="image-upload" class="upload-btn">
                    <i class="fa fa-upload mr-1"></i>é€‰æ‹©å›¾ç‰‡
                </label>
                <input type="file" id="image-upload" accept="image/jpeg, image/png, image/gif">
                <p class="upload-info">æ”¯æŒJPGã€PNGã€GIFæ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡2MBï¼Œå»ºè®®å°ºå¯¸320x320åƒç´ </p>
                
                <img id="upload-preview" class="upload-preview" src="" alt="é¢„è§ˆå›¾">
                
                <div class="upload-actions" id="upload-actions">
                    <button id="confirm-upload" class="upload-confirm">ç¡®è®¤ä½¿ç”¨</button>
                    <button id="cancel-upload" class="upload-cancel">å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- æäº¤æŒ‰é’® -->
            <div class="text-center mt-6">
                <button id="submit-drawing" class="px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                    æäº¤ä½œå“
                </button>
            </div>
        </section>

        <!-- 3. å°å±‹åŒºåŸŸé¡µé¢ -->
        <section id="room" class="page">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold mb-2">æˆ‘çš„å°å±‹</h2>
                <p class="text-gray-500">è‡ªç”±æ‘†æ”¾å®¶å…·ï¼Œæ‰“é€ ä¸“å±ç©ºé—´</p>
            </div>
            <!-- å°å±‹æ“ä½œæ  -->
            <div class="flex justify-center gap-4 mb-6 flex-wrap">
                <button id="move-btn" class="px-4 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors active">
                    <i class="fa fa-arrows mr-1"></i>ç§»åŠ¨
                </button>
                <button id="rotate-btn" class="px-4 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                    <i class="fa fa-repeat mr-1"></i>æ—‹è½¬
                </button>
                <button id="scale-btn" class="px-4 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                    <i class="fa fa-search-plus mr-1"></i>ç¼©æ”¾
                </button>
                <button id="delete-btn" class="px-4 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                    <i class="fa fa-trash mr-1"></i>ç§»é™¤
                </button>
            </div>
            <!-- æ­£æ–¹å½¢å°å±‹ -->
            <div id="room-container" class="w-[80vw] h-[80vw] max-w-[600px] max-h-[600px] mx-auto relative overflow-hidden">
                <!-- å¢™å£ -->
                <div class="room-wall top-0 left-0 w-100% h-20%"></div>
                
                <!-- åœ°æ¿ -->
                <div class="room-floor"></div>
                
                <!-- çª—æˆ· -->
                <div class="room-window"></div>
                
                <!-- é—¨ -->
                <div class="room-door"></div>
                
                <!-- è§’è½è£…é¥° -->
                <div class="room-corner top-left"></div>
                <div class="room-corner top-right"></div>
                
                <!-- å®¶å…·æ‘†æ”¾åŒºåŸŸï¼ˆåŠ¨æ€ç”Ÿæˆå®¶å…·ï¼‰ -->
                <div id="furniture-container" class="w-full h-full"></div>
            </div>
            
            <!-- å®¶å…·é€‰æ‹© -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-4 text-center">æˆ‘çš„å®¶å…·</h3>
                <div id="furniture-selection" class="flex flex-wrap justify-center gap-4 max-w-4xl mx-auto">
                    <!-- å®¶å…·å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div id="empty-furniture" class="text-center py-6 text-gray-500">
                    <i class="fa fa-cube text-3xl mb-2"></i>
                    <p>è¿˜æ²¡æœ‰å®¶å…·ï¼Œå¿«å»ç»˜åˆ¶å§ï¼</p>
                </div>
            </div>
        </section>

        <!-- 4. è´´çº¸è£…é¥°é¡µé¢ -->
        <section id="stickers" class="page">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold mb-2">è´´çº¸è£…é¥°</h2>
                <p class="text-gray-500">ä½¿ç”¨è´´çº¸è£…é¥°ä½ çš„é¡µé¢ï¼Œæ‹–åŠ¨æ”¾ç½®ä»»æ„ä½ç½®</p>
            </div>
            
            <!-- è´´çº¸å±•ç¤º -->
            <div id="sticker-collection" class="max-w-4xl mx-auto grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
                <!-- è´´çº¸å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸƒ">ğŸƒ</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ‘»">ğŸ‘»</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ•·ï¸">ğŸ•·ï¸</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ¦‡">ğŸ¦‡</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ•¸ï¸">ğŸ•¸ï¸</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ¬">ğŸ¬</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ­">ğŸ­</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ§™">ğŸ§™</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ•¯ï¸">ğŸ•¯ï¸</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="â˜ ï¸">â˜ ï¸</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ’€">ğŸ’€</div>
                <div class="sticker-item bg-white rounded-lg p-3 text-center cursor-pointer hover:bg-gray-100 transition-colors" data-sticker="ğŸ”®">ğŸ”®</div>
            </div>
            
            <!-- è´´çº¸ä½¿ç”¨è¯´æ˜ -->
            <div class="max-w-2xl mx-auto text-center text-gray-500">
                <p>ç‚¹å‡»è´´çº¸é€‰æ‹©ï¼Œç„¶ååœ¨é¡µé¢ä¸Šç‚¹å‡»æ”¾ç½®ä½ç½®</p>
                <p>å·²æ”¾ç½®çš„è´´çº¸å¯ä»¥æ‹–åŠ¨ã€ç¼©æ”¾å’Œåˆ é™¤</p>
            </div>
        </section>

        <!-- 5. å®¶å…·æ”¶è—é¡µé¢ -->
        <section id="collection" class="page">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold mb-2">å®¶å…·æ”¶è—</h2>
                <p class="text-gray-500">æŸ¥çœ‹å·²æ”¶é›†çš„å®¶å…·ï¼Œè†å¬å®ƒä»¬çš„æ•…äº‹</p>
            </div>
            <!-- é£æ ¼ç­›é€‰ -->
            <div class="flex justify-center gap-3 mb-6 flex-wrap">
                <button class="px-3 py-1 bg-gray-700 text-white rounded filter-btn" data-filter="all">å…¨éƒ¨</button>
                <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors filter-btn" data-filter="ä¸‡åœ£èŠ‚">ä¸‡åœ£èŠ‚</button>
                <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors filter-btn" data-filter="æ£®ç³»">æ£®ç³»</button>
                <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors filter-btn" data-filter="å¤å¤">å¤å¤</button>
                <button class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors filter-btn" data-filter="ç°ä»£">ç°ä»£</button>
            </div>
            <!-- å®¶å…·å±•ç¤ºç½‘æ ¼ -->
            <div id="collection-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 max-w-5xl mx-auto">
                <!-- å®¶å…·å¡ç‰‡ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ -->
            </div>
            
            <!-- å…¨æ”¶é›†å¥–åŠ± -->
            <div id="full-collection" class="text-center mt-12 hidden">
                <h3 class="text-xl font-bold mb-4">æ­å–œï¼ä½ å·²æ”¶é›†æ‰€æœ‰å®¶å…·ï¼</h3>
                <div class="relative h-64">
                    <!-- å¹½çµå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <p class="text-gray-600 mt-4">ä½ çš„å°å±‹å……æ»¡äº†ä¸‡åœ£èŠ‚çš„é­”åŠ›ï¼Œå¹½çµä»¬ä¹Ÿè¢«å¸å¼•æ¥äº†ï¼</p>
            </div>
        </section>

        <!-- 6. å°æ¸¸æˆé¡µé¢ -->
        <section id="games" class="page">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold mb-2">å°æ¸¸æˆ</h2>
                <p class="text-gray-500">å®Œæˆæ¸¸æˆè·å–æ‰­è›‹å’Œç¨€æœ‰å®¶å…·</p>
            </div>
            
            <div class="max-w-2xl mx-auto">
                <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <div class="w-20 h-20 mx-auto mb-4 flex items-center justify-center bg-gray-100 rounded-full">
                        <i class="fa fa-bolt text-gray-700 text-3xl"></i>
                    </div>
                    <h4 class="font-medium mb-2">æ¸¸æˆä¸­å¿ƒ</h4>
                    <p class="text-sm text-gray-500 mb-4">å®Œæˆæ¸¸æˆè·å–æ‰­è›‹å’Œç¨€æœ‰å®¶å…·</p>
                    <button id="game-enter" class="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-800 transition-colors">
                        å¼€å§‹æ¸¸æˆ
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <footer class="bg-white py-6 border-t border-gray-200">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>Â© 2025 ä¼Šæ³½å°”çš„ä¸‡åœ£èŠ‚æ‰­è›‹å°å±‹ | æ¸©é¦¨æ²»æ„ˆ Â· åˆ›æ„ç©ºé—´æ„å»º</p>
        </div>
    </footer>

    <!-- æ¸¸æˆé€‰æ‹©ç•Œé¢ -->
    <div id="game-container" class="game-container">
        <div id="game-close" class="text-2xl cursor-pointer">Ã—</div>
        <h2 class="game-title">é€‰æ‹©æ¸¸æˆ</h2>
        <div class="game-description">é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå¼€å§‹æ¸¸ç©ï¼Œèµ¢å–æ‰­è›‹å¥–åŠ±ï¼</div>
        
        <div id="game-selection">
            <div class="game-option" data-game="memory">
                <div class="game-icon">ğŸ§ </div>
                <div class="game-info">
                    <div class="game-title">è®°å¿†ç¿»ç‰Œ</div>
                    <div class="game-reward">å¥–åŠ±: 3ä¸ªæ‰­è›‹</div>
                </div>
            </div>
            <div class="game-option" data-game="pumpkin">
                <div class="game-icon">ğŸƒ</div>
                <div class="game-info">
                    <div class="game-title">å—ç“œæ¥ç‰©</div>
                    <div class="game-reward">å¥–åŠ±: æ¯10åˆ†1ä¸ªæ‰­è›‹</div>
                </div>
            </div>
        </div>
    </div>

    <!-- è®°å¿†ç¿»ç‰Œæ¸¸æˆ -->
    <div id="memory-game-container" class="game-container">
        <div id="memory-close" class="text-2xl cursor-pointer">Ã—</div>
        <h2 class="game-title">è®°å¿†ç¿»ç‰Œ</h2>
        <div class="game-description">ç¿»å¼€å¡ç‰‡æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„å›¾æ¡ˆ</div>
        
        <div id="memory-game"></div>
        
        <div class="game-controls">
            <div id="memory-score">å·²åŒ¹é…: 0/8</div>
            <button id="memory-restart" class="game-button">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <!-- å—ç“œæ¥ç‰©æ¸¸æˆ -->
    <div id="pumpkin-game-container" class="game-container">
        <div id="pumpkin-close" class="text-2xl cursor-pointer">Ã—</div>
        <h2 class="game-title">å—ç“œæ¥ç‰©</h2>
        <div class="game-description">ç”¨ç¯®å­æ¥ä½æ‰è½çš„å—ç“œ</div>
        
        <div id="pumpkin-game">
            <div id="pumpkin-basket"></div>
        </div>
        
        <div class="game-controls">
            <div id="pumpkin-score">å¾—åˆ†: 0</div>
            <button id="pumpkin-start" class="game-button">å¼€å§‹æ¸¸æˆ</button>
            <button id="pumpkin-restart" class="game-button">é‡æ–°å¼€å§‹</button>
        </div>
        
        <div id="pumpkin-instruction">ä½¿ç”¨å·¦å³æ–¹å‘é”®ç§»åŠ¨ç¯®å­</div>
    </div>

    <!-- æ¸¸æˆç»“æœå¼¹çª— -->
    <div id="game-result" class="game-result">
        <h3 id="result-title">æ¸¸æˆç»“æŸ</h3>
        <div id="game-score">å¾—åˆ†: 0</div>
        <div id="game-reward">å¥–åŠ±: 0ä¸ªæ‰­è›‹</div>
        <button id="result-close" class="game-button">ç¡®å®š</button>
    </div>

    <!-- è·å¾—ç‰©å“å¼¹çª— -->
    <div id="reward-modal" class="reward-modal">
        <div class="reward-content">
            <div id="reward-icon" class="reward-icon"></div>
            <div id="reward-title" class="reward-title">æ­å–œè·å¾—æ–°ç‰©å“ï¼</div>
            <div id="reward-name" class="reward-name"></div>
            <div id="reward-description" class="reward-description"></div>
            <button id="reward-close" class="reward-close">ç¡®å®š</button>
        </div>
    </div>

    <!-- å›¾ç‰‡ä¸Šä¼ ç¡®è®¤å¼¹çª— -->
    <div id="upload-confirm-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">ç¡®è®¤ä¸Šä¼ </h3>
            <p>ä½ ç¡®å®šè¦ä½¿ç”¨è¿™å¼ å›¾ç‰‡ä½œä¸ºå®¶å…·å—ï¼Ÿ</p>
            <p class="text-sm text-gray-500 mt-2">å›¾ç‰‡å°†è¢«è°ƒæ•´ä¸º320x320åƒç´ </p>
            <div class="modal-buttons">
                <button id="modal-confirm-btn" class="modal-btn modal-confirm">ç¡®è®¤</button>
                <button id="modal-cancel-btn" class="modal-btn modal-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡å¤§å°è¶…é™æç¤ºå¼¹çª— -->
    <div id="file-size-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">æ–‡ä»¶è¿‡å¤§</h3>
            <p>è¯·é€‰æ‹©å°äº2MBçš„å›¾ç‰‡æ–‡ä»¶</p>
            <div class="modal-buttons">
                <button id="size-modal-ok" class="modal-btn modal-confirm">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentTool = 'pen';
        let brushSize = 1;
        let brushColor = '#000000';
        let isDrawing = false;
        let currentShape = 'rectangle';
        let stabilizerLevel = 3;
        let currentSticker = null;
        let selectedFurniture = null;
        let currentAction = 'move';
        let eggs = 10;
        let furnitureCount = 0;
        let stickerCount = 0;
        let placedStickers = [];
        let userFurniture = [];
        let selectedFurnitureId = null;
        let currentDrawingTheme = null;
        let startX, startY; // ç”¨äºå›¾å½¢ç»˜åˆ¶çš„èµ·å§‹åæ ‡
        let canvasHistory = []; // ç”¨äºæ’¤å›åŠŸèƒ½çš„ç”»å¸ƒå†å²è®°å½•
        let historyIndex = -1; // å½“å‰å†å²è®°å½•ç´¢å¼•

        // 60ä¸ªemojiå®¶å…·æ•°æ®
        const furnitureData = [
            // ä¸‡åœ£èŠ‚é£æ ¼
            { id: 1, emoji: 'ğŸƒ', name: 'å—ç“œç¯', description: 'ç»å…¸ä¸‡åœ£èŠ‚å—ç“œç¯ï¼Œå¤œæ™šä¼šå‘å‡ºæ¸©æš–çš„æ©™è‰²å…‰èŠ’', style: 'ä¸‡åœ£èŠ‚' },
            { id: 2, emoji: 'ğŸ‘»', name: 'å¹½çµæ‘†ä»¶', description: 'æ¼‚æµ®çš„å¹½çµè£…é¥°ï¼Œå¸¦æœ‰è½»å¾®çš„å‘å…‰æ•ˆæœ', style: 'ä¸‡åœ£èŠ‚' },
            { id: 3, emoji: 'ğŸ•·ï¸', name: 'èœ˜è››æŒ‚é¥°', description: 'æ¯›èŒ¸èŒ¸çš„èœ˜è››è£…é¥°ï¼Œå¢æ·»ä¸‡åœ£èŠ‚æ°”æ°›', style: 'ä¸‡åœ£èŠ‚' },
            { id: 4, emoji: 'ğŸ¦‡', name: 'è™è å£ç¯', description: 'é€ å‹ç‹¬ç‰¹çš„è™è å£ç¯ï¼Œå…‰çº¿æŸ”å’Œ', style: 'ä¸‡åœ£èŠ‚' },
            { id: 5, emoji: 'ğŸ•¸ï¸', name: 'è››ç½‘æ¡Œå¸ƒ', description: 'ç²¾è‡´çš„èœ˜è››ç½‘å›¾æ¡ˆæ¡Œå¸ƒ', style: 'ä¸‡åœ£èŠ‚' },
            { id: 6, emoji: 'ğŸ’€', name: 'éª·é«…èŠ±ç“¶', description: 'éª·é«…é€ å‹çš„èŠ±ç“¶ï¼Œé€‚åˆæ‘†æ”¾å¹²èŠ±', style: 'ä¸‡åœ£èŠ‚' },
            { id: 7, emoji: 'â˜ ï¸', name: 'æµ·ç›—æ——æŒ‚æ¯¯', description: 'å¸¦æœ‰éª·é«…æ ‡å¿—çš„æµ·ç›—æ——è£…é¥°', style: 'ä¸‡åœ£èŠ‚' },
            { id: 8, emoji: 'ğŸ§™', name: 'å·«å¸ˆç©å¶', description: 'ç©¿ç€é»‘è¢çš„å·«å¸ˆç©å¶ï¼Œæ‰‹æŒé­”æ³•æ–', style: 'ä¸‡åœ£èŠ‚' },
            { id: 9, emoji: 'ğŸ•¯ï¸', name: 'å—ç“œèœ¡çƒ›', description: 'å—ç“œå½¢çŠ¶çš„é¦™è–°èœ¡çƒ›ï¼Œæ•£å‘å—ç“œé¦™å‘³', style: 'ä¸‡åœ£èŠ‚' },
            { id: 10, emoji: 'ğŸ¬', name: 'ç³–æœç½', description: 'è£…æ»¡ä¸‡åœ£èŠ‚ç³–æœçš„ç»ç’ƒç½', style: 'ä¸‡åœ£èŠ‚' },
            { id: 11, emoji: 'ğŸ­', name: 'æ£’æ£’ç³–åå«', description: 'å·¨å¤§çš„æ£’æ£’ç³–é€ å‹åå«ï¼ŒæŸ”è½¯èˆ’é€‚', style: 'ä¸‡åœ£èŠ‚' },
            { id: 12, emoji: 'ğŸ”®', name: 'æ°´æ™¶çƒ', description: 'ç¥ç§˜çš„æ°´æ™¶çƒï¼Œæ®è¯´èƒ½é¢„æµ‹æœªæ¥', style: 'ä¸‡åœ£èŠ‚' },
            
            // æ£®ç³»é£æ ¼
            { id: 13, emoji: 'ğŸŒ²', name: 'è¿·ä½ åœ£è¯æ ‘', description: 'å°å‹åœ£è¯æ ‘ç›†æ ½ï¼Œå…¨å¹´å¸¸ç»¿', style: 'æ£®ç³»' },
            { id: 14, emoji: 'ğŸŒ¿', name: 'è•¨ç±»æ¤ç‰©', description: 'ä¼˜é›…çš„è•¨ç±»æ¤ç‰©ï¼Œé€‚åˆæ”¾åœ¨ä¹¦æ¡Œ', style: 'æ£®ç³»' },
            { id: 15, emoji: 'ğŸƒ', name: 'å¶ç‰‡åœ°æ¯¯', description: 'å¶ç‰‡å½¢çŠ¶çš„æŸ”è½¯åœ°æ¯¯', style: 'æ£®ç³»' },
            { id: 16, emoji: 'ğŸŒ³', name: 'æ ‘æ¡©å°æ¡Œ', description: 'å¤©ç„¶æ ‘æ¡©åˆ¶æˆçš„å°æ¡Œå­', style: 'æ£®ç³»' },
            { id: 17, emoji: 'ğŸ„', name: 'è˜‘è‡å°ç¯', description: 'è˜‘è‡é€ å‹çš„å°å¤œç¯ï¼Œå…‰çº¿æŸ”å’Œ', style: 'æ£®ç³»' },
            { id: 18, emoji: 'ğŸ¿ï¸', name: 'æ¾é¼ æ‘†ä»¶', description: 'å¯çˆ±çš„æ¾é¼ é€ å‹è£…é¥°å“', style: 'æ£®ç³»' },
            { id: 19, emoji: 'ğŸ¦”', name: 'åˆºçŒ¬é å«', description: 'åˆºçŒ¬å½¢çŠ¶çš„é å«ï¼ŒæŸ”è½¯èˆ’é€‚', style: 'æ£®ç³»' },
            { id: 20, emoji: 'ğŸŒ¾', name: 'éº¦ç©—æŒ‚é¥°', description: 'å¤©ç„¶éº¦ç©—åˆ¶æˆçš„å¢™é¢æŒ‚é¥°', style: 'æ£®ç³»' },
            { id: 21, emoji: 'ğŸ‚', name: 'æ«å¶è£…é¥°ç”»', description: 'æ«å¶å›¾æ¡ˆçš„è£…é¥°ç”»', style: 'æ£®ç³»' },
            { id: 22, emoji: 'ğŸŒµ', name: 'ä»™äººæŒç›†æ ½', description: 'æ˜“å…»æŠ¤çš„ä»™äººæŒå°ç›†æ ½', style: 'æ£®ç³»' },
            { id: 23, emoji: 'ğŸŒ¼', name: 'èŠ±æœµåœ°æ¯¯', description: 'èŠ±æœµå›¾æ¡ˆçš„æŸ”è½¯åœ°æ¯¯', style: 'æ£®ç³»' },
            { id: 24, emoji: 'ğŸ¦‹', name: 'è´è¶çª—å¸˜', description: 'å¸¦æœ‰è´è¶å›¾æ¡ˆçš„è½»è–„çª—å¸˜', style: 'æ£®ç³»' },
            
            // å¤å¤é£æ ¼
            { id: 25, emoji: 'ğŸ“»', name: 'å¤å¤æ”¶éŸ³æœº', description: 'è€å¼æ”¶éŸ³æœºï¼Œèƒ½æ’­æ”¾æ€€æ—§éŸ³ä¹', style: 'å¤å¤' },
            { id: 26, emoji: 'ğŸ“½ï¸', name: 'ç”µå½±æ”¾æ˜ æœº', description: 'è€å¼ç”µå½±æ”¾æ˜ æœºæ¨¡å‹', style: 'å¤å¤' },
            { id: 27, emoji: 'ğŸ“', name: 'æ—‹è½¬æ‹¨å·ç”µè¯', description: 'ç»å…¸æ—‹è½¬æ‹¨å·ç”µè¯', style: 'å¤å¤' },
            { id: 28, emoji: 'ğŸ’½', name: 'é»‘èƒ¶å”±ç‰‡æœº', description: 'è€å¼é»‘èƒ¶å”±ç‰‡æœºï¼Œå¸¦æœ‰æ€€æ—§æ„Ÿ', style: 'å¤å¤' },
            { id: 29, emoji: 'ğŸ“š', name: 'çš®è´¨ä¹¦æ¶', description: 'å¤å¤çš®è´¨å°é¢çš„ä¹¦æ¶', style: 'å¤å¤' },
            { id: 30, emoji: 'ğŸ•°ï¸', name: 'åº§é’Ÿ', description: 'ç»å…¸åº§é’Ÿï¼Œå¸¦æœ‰æ¸…è„†çš„æŠ¥æ—¶å£°', style: 'å¤å¤' },
            { id: 31, emoji: 'âš™ï¸', name: 'é½¿è½®è£…é¥°', description: 'å·¥ä¸šé£é½¿è½®è£…é¥°æ‘†ä»¶', style: 'å¤å¤' },
            { id: 32, emoji: 'ğŸï¸', name: 'èƒ¶ç‰‡æŒ‚é¥°', description: 'è€å¼ç”µå½±èƒ¶ç‰‡åˆ¶æˆçš„æŒ‚é¥°', style: 'å¤å¤' },
            { id: 33, emoji: 'ğŸ”', name: 'é“œåˆ¶æœ›è¿œé•œ', description: 'å¤å¤é“œåˆ¶æœ›è¿œé•œæ‘†ä»¶', style: 'å¤å¤' },
            { id: 34, emoji: 'ğŸ“œ', name: 'å·è½´æŒ‚ç”»', description: 'å¯å·èµ·çš„å¤å¤é£æ ¼æŒ‚ç”»', style: 'å¤å¤' },
            { id: 35, emoji: 'ğŸº', name: 'é™¶ç“·èŠ±ç“¶', description: 'å¤å¤é£æ ¼é™¶ç“·èŠ±ç“¶', style: 'å¤å¤' },
            { id: 36, emoji: 'ğŸš²', name: 'è‡ªè¡Œè½¦æ¨¡å‹', description: 'å¤å¤è‡ªè¡Œè½¦ç²¾è‡´æ¨¡å‹', style: 'å¤å¤' },
            
            // ç°ä»£é£æ ¼
            { id: 37, emoji: 'ğŸ’»', name: 'ç¬”è®°æœ¬ç”µè„‘æ”¯æ¶', description: 'ç®€çº¦ç°ä»£çš„ç¬”è®°æœ¬ç”µè„‘æ”¯æ¶', style: 'ç°ä»£' },
            { id: 38, emoji: 'ğŸ’¡', name: 'LEDå°ç¯', description: 'å¯è°ƒèŠ‚äº®åº¦çš„ç°ä»£LEDå°ç¯', style: 'ç°ä»£' },
            { id: 39, emoji: 'ğŸ”Œ', name: 'æ— çº¿å……ç”µå™¨', description: 'ç®€çº¦è®¾è®¡çš„æ— çº¿å……ç”µå™¨', style: 'ç°ä»£' },
            { id: 40, emoji: 'ğŸ“±', name: 'æ‰‹æœºæ”¯æ¶', description: 'å¤šè§’åº¦è°ƒèŠ‚çš„æ‰‹æœºæ”¯æ¶', style: 'ç°ä»£' },
            { id: 41, emoji: 'ğŸ§', name: 'è€³æœºæ¶', description: 'æ—¶å°šè€³æœºæ¶ï¼ŒèŠ‚çœæ¡Œé¢ç©ºé—´', style: 'ç°ä»£' },
            { id: 42, emoji: 'ğŸ–±ï¸', name: 'é¼ æ ‡å«', description: 'é¡ºæ»‘è¡¨é¢çš„ç°ä»£é£æ ¼é¼ æ ‡å«', style: 'ç°ä»£' },
            { id: 43, emoji: 'ğŸ“¦', name: 'æ”¶çº³ç›’', description: 'æ¨¡å—åŒ–è®¾è®¡çš„æ”¶çº³ç›’', style: 'ç°ä»£' },
            { id: 44, emoji: 'ğŸ–¼ï¸', name: 'ç®€çº¦ç”»æ¡†', description: 'æ— æ¡†è®¾è®¡çš„ç°ä»£é£æ ¼ç”»æ¡†', style: 'ç°ä»£' },
            { id: 45, emoji: 'ğŸ§º', name: 'ç¼–ç»‡ç¯®', description: 'ç®€çº¦è®¾è®¡çš„ç¼–ç»‡æ”¶çº³ç¯®', style: 'ç°ä»£' },
            { id: 46, emoji: 'ğŸ’¨', name: 'æ¡Œé¢é£æ‰‡', description: 'é™éŸ³è®¾è®¡çš„æ¡Œé¢å°é£æ‰‡', style: 'ç°ä»£' },
            { id: 47, emoji: 'ğŸŒ¡ï¸', name: 'æ¸©æ¹¿åº¦è®¡', description: 'ç°ä»£è®¾è®¡çš„æ¸©æ¹¿åº¦è®¡', style: 'ç°ä»£' },
            { id: 48, emoji: 'ğŸ”‹', name: 'å……ç”µå®', description: 'è½»è–„ä¾¿æºçš„å……ç”µå®', style: 'ç°ä»£' },
            
            // é¢å¤–20ä¸ªå®¶å…·ï¼Œå¹³å‡åˆ†é…åˆ°å„é£æ ¼
            { id: 49, emoji: 'ğŸ¦‰', name: 'çŒ«å¤´é¹°æ‘†ä»¶', description: 'ä¸‡åœ£èŠ‚ä¸»é¢˜çŒ«å¤´é¹°è£…é¥°', style: 'ä¸‡åœ£èŠ‚' },
            { id: 50, emoji: 'ğŸ', name: 'æ¯’è‹¹æœæ‘†ä»¶', description: 'ç«¥è¯é£æ ¼çš„æ¯’è‹¹æœè£…é¥°', style: 'ä¸‡åœ£èŠ‚' },
            { id: 51, emoji: 'ğŸ§›', name: 'å¸è¡€é¬¼ç©å¶', description: 'ä¸‡åœ£èŠ‚å¸è¡€é¬¼é€ å‹ç©å¶', style: 'ä¸‡åœ£èŠ‚' },
            { id: 52, emoji: 'ğŸ•¸ï¸', name: 'èœ˜è››æŠ±æ•', description: 'èœ˜è››é€ å‹çš„æŸ”è½¯æŠ±æ•', style: 'ä¸‡åœ£èŠ‚' },
            
            { id: 53, emoji: 'ğŸ¦', name: 'å°é¸Ÿå–‚é£Ÿå™¨', description: 'å¸å¼•å°é¸Ÿçš„æ‚¬æŒ‚å¼å–‚é£Ÿå™¨', style: 'æ£®ç³»' },
            { id: 54, emoji: 'ğŸŒ²', name: 'æ¾æœè£…é¥°', description: 'å¤©ç„¶æ¾æœåˆ¶æˆçš„è£…é¥°å“', style: 'æ£®ç³»' },
            { id: 55, emoji: 'ğŸŒŠ', name: 'è´å£³é£é“ƒ', description: 'æµ·é£ä¸€å¹å°±å‘å‡ºæ‚¦è€³å£°éŸ³', style: 'æ£®ç³»' },
            { id: 56, emoji: 'ğŸ¢', name: 'ä¹Œé¾Ÿæ‘†ä»¶', description: 'è±¡å¾é•¿å¯¿çš„ä¹Œé¾Ÿè£…é¥°å“', style: 'æ£®ç³»' },
            
            { id: 57, emoji: 'ğŸ“–', name: 'å¤å¤æ—¥è®°æœ¬', description: 'çš®è´¨å°é¢çš„å¤å¤æ—¥è®°æœ¬', style: 'å¤å¤' },
            { id: 58, emoji: 'âœ’ï¸', name: 'ç¾½æ¯›ç¬”å¥—è£…', description: 'å¤å¤ç¾½æ¯›ç¬”å’Œå¢¨æ°´ç“¶å¥—è£…', style: 'å¤å¤' },
            { id: 59, emoji: 'ğŸ’°', name: 'å¤å¤é’±ç®±', description: 'å¸¦æœ‰é“œé”çš„å¤å¤é’±ç®±', style: 'å¤å¤' },
            { id: 60, emoji: 'ğŸ­', name: 'æˆå‰§é¢å…·', description: 'å¤å¤æˆå‰§é£æ ¼é¢å…·', style: 'å¤å¤' },
            
            { id: 61, emoji: 'ğŸ“Œ', name: 'ç£æ€§ç•™è¨€æ¿', description: 'ç°ä»£è®¾è®¡çš„ç£æ€§ç•™è¨€æ¿', style: 'ç°ä»£' },
            { id: 62, emoji: 'ğŸ—‘ï¸', name: 'è¿·ä½ åƒåœ¾æ¡¶', description: 'ç®€çº¦è®¾è®¡çš„æ¡Œé¢åƒåœ¾æ¡¶', style: 'ç°ä»£' },
            { id: 63, emoji: 'ğŸ”–', name: 'ä¹¦ç­¾ç¯', description: 'å…¼å…·ä¹¦ç­¾åŠŸèƒ½çš„LEDå°ç¯', style: 'ç°ä»£' },
            { id: 64, emoji: 'ğŸ§¼', name: 'é¦™è–°æœº', description: 'è¶…å£°æ³¢é¦™è–°æœºï¼Œå‡€åŒ–ç©ºæ°”', style: 'ç°ä»£' },
            
            { id: 65, emoji: 'ğŸƒ', name: 'å—ç“œæŠ±æ•', description: 'æŸ”è½¯çš„å—ç“œé€ å‹æŠ±æ•', style: 'ä¸‡åœ£èŠ‚' },
            { id: 66, emoji: 'ğŸŒ¿', name: 'æ‚¬æŒ‚æ¤ç‰©', description: 'å¯ä»¥æ‚¬æŒ‚çš„ç©ºæ°”å‡¤æ¢¨', style: 'æ£®ç³»' },
            { id: 67, emoji: 'ğŸ“½ï¸', name: 'å¤å¤å¹»ç¯æœº', description: 'è€å¼å¹»ç¯æœºæ¨¡å‹', style: 'å¤å¤' },
            { id: 68, emoji: 'ğŸ’»', name: 'ç”µè„‘å¢é«˜æ¶', description: 'å¸¦æ”¶çº³åŠŸèƒ½çš„ç”µè„‘å¢é«˜æ¶', style: 'ç°ä»£' },
            { id: 69, emoji: 'ğŸ‘»', name: 'å¹½çµå¤œç¯', description: 'æŸ”å’Œå‘å…‰çš„å¹½çµé€ å‹å¤œç¯', style: 'ä¸‡åœ£èŠ‚' },
            { id: 70, emoji: 'ğŸ¦‹', name: 'è´è¶æ ‡æœ¬æ¡†', description: 'çœŸå®è´è¶æ ‡æœ¬è£…é¥°æ¡†', style: 'æ£®ç³»' }
        ];

        // DOMå…ƒç´ 
        const navBtns = document.querySelectorAll('.nav-btn');
        const pages = document.querySelectorAll('.page');
        const toolBtns = document.querySelectorAll('.tool-btn');
        const shapeSelector = document.getElementById('shape-selector');
        const brushSizeInput = document.getElementById('brush-size');
        const brushSizeValue = document.getElementById('brush-size-value');
        const brushColorInput = document.getElementById('brush-color');
        const colorPreview = document.getElementById('color-preview');
        const stabilizerLevelInput = document.getElementById('stabilizer-level');
        const stabilizerLevelValue = document.getElementById('stabilizer-value');
        const clearCanvasBtn = document.getElementById('clear-canvas');
        const undoBtn = document.getElementById('undo-btn');
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const submitDrawingBtn = document.getElementById('submit-drawing');
        const imageUpload = document.getElementById('image-upload');
        const uploadPreview = document.getElementById('upload-preview');
        const uploadActions = document.getElementById('upload-actions');
        const confirmUploadBtn = document.getElementById('confirm-upload');
        const cancelUploadBtn = document.getElementById('cancel-upload');
        const gachaBtn = document.getElementById('gacha-btn');
        const waitingEgg = document.getElementById('waiting-egg');
        const eggDropContainer = document.getElementById('egg-drop-container');
        const droppingEgg = document.getElementById('dropping-egg');
        const resultShow = document.getElementById('result-show');
        const resultContent = document.getElementById('result-content');
        const eggCountEl = document.getElementById('egg-count');
        const furnitureCountEl = document.getElementById('furniture-count');
        const stickerCountEl = document.getElementById('sticker-count');
        const roomContainer = document.getElementById('room-container');
        const furnitureContainer = document.getElementById('furniture-container');
        const furnitureSelection = document.getElementById('furniture-selection');
        const emptyFurniture = document.getElementById('empty-furniture');
        const moveBtn = document.getElementById('move-btn');
        const rotateBtn = document.getElementById('rotate-btn');
        const scaleBtn = document.getElementById('scale-btn');
        const deleteBtn = document.getElementById('delete-btn');
        const stickerItems = document.querySelectorAll('.sticker-item');
        const collectionGrid = document.getElementById('collection-grid');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const musicControl = document.getElementById('music-control');
        const backgroundMusic = document.getElementById('background-music');
        const uploadConfirmModal = document.getElementById('upload-confirm-modal');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const fileSizeModal = document.getElementById('file-size-modal');
        const sizeModalOk = document.getElementById('size-modal-ok');
        const drawingTheme = document.getElementById('drawing-theme');
        const drawingDesc = document.getElementById('drawing-desc');

        // è·å¾—ç‰©å“å¼¹çª—ç›¸å…³å…ƒç´ 
        const rewardModal = document.getElementById('reward-modal');
        const rewardIcon = document.getElementById('reward-icon');
        const rewardTitle = document.getElementById('reward-title');
        const rewardName = document.getElementById('reward-name');
        const rewardDescription = document.getElementById('reward-description');
        const rewardClose = document.getElementById('reward-close');

        // æ¸¸æˆç›¸å…³DOMå…ƒç´ 
        const gameEnterBtn = document.getElementById('game-enter');
        const gameContainer = document.getElementById('game-container');
        const gameCloseBtn = document.getElementById('game-close');
        const gameOptions = document.querySelectorAll('.game-option');
        const memoryGameContainer = document.getElementById('memory-game-container');
        const memoryCloseBtn = document.getElementById('memory-close');
        const memoryGame = document.getElementById('memory-game');
        const memoryRestartBtn = document.getElementById('memory-restart');
        const memoryScoreEl = document.getElementById('memory-score');
        const pumpkinGameContainer = document.getElementById('pumpkin-game-container');
        const pumpkinCloseBtn = document.getElementById('pumpkin-close');
        const pumpkinGame = document.getElementById('pumpkin-game');
        const pumpkinStartBtn = document.getElementById('pumpkin-start');
        const pumpkinRestartBtn = document.getElementById('pumpkin-restart');
        const pumpkinScoreEl = document.getElementById('pumpkin-score');
        const gameResult = document.getElementById('game-result');
        const resultTitle = document.getElementById('result-title');
        const gameScoreEl = document.getElementById('game-score');
        const gameRewardEl = document.getElementById('game-reward');
        const resultCloseBtn = document.getElementById('result-close');

        // æ¸¸æˆçŠ¶æ€å˜é‡
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let pumpkinScore = 0;
        let pumpkinGameActive = false;
        let basketPosition = 150;
        let fallingPumpkins = [];
        let pumpkinInterval;

        // åˆå§‹åŒ–
        function init() {
            // åˆå§‹åŒ–ç”»å¸ƒ - è®¾ç½®ä¸ºé€æ˜èƒŒæ™¯
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // åˆå§‹åŒ–å®¶å…·æ”¶è—
            renderFurnitureCollection();
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadData();
            
            // æ›´æ–°è®¡æ•°æ˜¾ç¤º
            updateCounts();
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGames();
            
            // åˆå§‹åŒ–ç»˜ç”»å·¥å…·
            initDrawingTools();
            
            // ä¿å­˜åˆå§‹ç”»å¸ƒçŠ¶æ€
            saveCanvasState();
        }

        // é¡µé¢å¯¼èˆª
        navBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const pageId = btn.getAttribute('data-page');
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
                navBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤º
                pages.forEach(page => {
                    page.classList.remove('active');
                    if (page.id === pageId) {
                        page.classList.add('active');
                    }
                });
            });
        });

        // å·¥å…·é€‰æ‹©
        toolBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tool = btn.getAttribute('data-tool');
                
                // æ›´æ–°å·¥å…·æŒ‰é’®çŠ¶æ€
                toolBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // æ›´æ–°å½“å‰å·¥å…·
                currentTool = tool;
                
                // æ˜¾ç¤º/éšè—å›¾å½¢é€‰æ‹©å™¨
                if (tool === 'shape') {
                    shapeSelector.classList.remove('hidden');
                } else {
                    shapeSelector.classList.add('hidden');
                }
            });
        });

        // å›¾å½¢é€‰æ‹©
        document.querySelectorAll('#shape-selector button').forEach(btn => {
            btn.addEventListener('click', () => {
                currentShape = btn.getAttribute('data-shape');
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('#shape-selector button').forEach(b => {
                    b.classList.remove('bg-gray-200');
                    b.classList.add('bg-white');
                });
                btn.classList.remove('bg-white');
                btn.classList.add('bg-gray-200');
            });
        });

        // ç”»ç¬”å¤§å°è°ƒæ•´
        brushSizeInput.addEventListener('input', () => {
            brushSize = parseInt(brushSizeInput.value);
            brushSizeValue.textContent = `${brushSize}px`;
        });

        // ç”»ç¬”é¢œè‰²è°ƒæ•´
        brushColorInput.addEventListener('input', () => {
            brushColor = brushColorInput.value;
            colorPreview.style.backgroundColor = brushColor;
        });

        // æŠ–åŠ¨ä¿®æ­£è°ƒæ•´
        stabilizerLevelInput.addEventListener('input', () => {
            stabilizerLevel = parseInt(stabilizerLevelInput.value);
            stabilizerLevelValue.textContent = stabilizerLevel;
        });

        // æ¸…ç©ºç”»å¸ƒ
        clearCanvasBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿ')) {
                // ä½¿ç”¨é€æ˜èƒŒæ™¯æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                submitDrawingBtn.disabled = true;
                saveCanvasState();
            }
        });

        // æ’¤å›åŠŸèƒ½
        undoBtn.addEventListener('click', undoLastAction);

        // åˆå§‹åŒ–ç»˜ç”»å·¥å…·
        function initDrawingTools() {
            // ç”»å¸ƒç»˜åˆ¶åŠŸèƒ½
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                startDrawing({ offsetX: x, offsetY: y });
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                draw({ offsetX: x, offsetY: y });
            });
            
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            
            // è®°å½•èµ·å§‹åæ ‡ï¼ˆç”¨äºå›¾å½¢ç»˜åˆ¶ï¼‰
            startX = e.offsetX;
            startY = e.offsetY;
            
            if (currentTool === 'pen' || currentTool === 'eraser') {
                ctx.beginPath();
                ctx.arc(e.offsetX, e.offsetY, brushSize / 2, 0, Math.PI * 2);
                ctx.fillStyle = currentTool === 'eraser' ? 'rgba(0,0,0,0)' : brushColor;
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(e.offsetX, e.offsetY);
            } else if (currentTool === 'bucket') {
                // æ²¹æ¼†æ¡¶åŠŸèƒ½ - å¡«å……åŒºåŸŸ
                floodFill(e.offsetX, e.offsetY, brushColor);
                saveCanvasState();
            }
            
            submitDrawingBtn.disabled = false;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            if (currentTool === 'pen' || currentTool === 'eraser') {
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.strokeStyle = currentTool === 'eraser' ? 'rgba(0,0,0,0)' : brushColor;
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                
                // é‡æ–°å¼€å§‹è·¯å¾„ï¼Œé¿å…çº¿æ¡è¿‡ç²—
                ctx.beginPath();
                ctx.moveTo(e.offsetX, e.offsetY);
            }
        }

        function stopDrawing() {
            isDrawing = false;
            
            // å¦‚æœæ˜¯å›¾å½¢å·¥å…·ï¼Œç»˜åˆ¶æœ€ç»ˆå›¾å½¢
            if (currentTool === 'shape' && startX !== undefined && startY !== undefined) {
                const endX = event.offsetX;
                const endY = event.offsetY;
                
                drawShape(startX, startY, endX, endY);
                saveCanvasState();
            } else if (currentTool === 'pen' || currentTool === 'eraser') {
                // ä¿å­˜ç”»ç¬”å’Œæ©¡çš®æ“¦æ“ä½œåçš„çŠ¶æ€
                saveCanvasState();
            }
        }

        // ç»˜åˆ¶å›¾å½¢
        function drawShape(startX, startY, endX, endY) {
            ctx.beginPath();
            
            switch(currentShape) {
                case 'rectangle':
                    ctx.rect(startX, startY, endX - startX, endY - startY);
                    break;
                case 'circle':
                    const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                    ctx.arc(startX, startY, radius, 0, Math.PI * 2);
                    break;
                case 'triangle':
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                    ctx.lineTo(startX * 2 - endX, endY);
                    ctx.closePath();
                    break;
                case 'star':
                    drawStar(ctx, startX, startY, 5, brushSize * 5, brushSize * 10);
                    break;
            }
            
            ctx.fillStyle = brushColor;
            ctx.fill();
        }

        // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
        function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            let step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
        }

        // æ´ªæ°´å¡«å……ç®—æ³•ï¼ˆæ²¹æ¼†æ¡¶ï¼‰
        function floodFill(startX, startY, fillColor) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            const startPos = (Math.floor(startY) * canvas.width + Math.floor(startX)) * 4;
            const startR = pixels[startPos];
            const startG = pixels[startPos + 1];
            const startB = pixels[startPos + 2];
            const startA = pixels[startPos + 3];
            
            // å¦‚æœèµ·å§‹é¢œè‰²å’Œå¡«å……é¢œè‰²ç›¸åŒï¼Œåˆ™ä¸è¿›è¡Œå¡«å……
            const fillR = parseInt(fillColor.substr(1, 2), 16);
            const fillG = parseInt(fillColor.substr(3, 2), 16);
            const fillB = parseInt(fillColor.substr(5, 2), 16);
            
            if (startR === fillR && startG === fillG && startB === fillB) {
                return;
            }
            
            const stack = [[startX, startY]];
            
            while (stack.length) {
                const [x, y] = stack.pop();
                const pos = (Math.floor(y) * canvas.width + Math.floor(x)) * 4;
                
                // æ£€æŸ¥è¾¹ç•Œå’Œé¢œè‰²åŒ¹é…
                if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height) continue;
                
                const r = pixels[pos];
                const g = pixels[pos + 1];
                const b = pixels[pos + 2];
                const a = pixels[pos + 3];
                
                if (r === startR && g === startG && b === startB && a === startA) {
                    // è®¾ç½®æ–°é¢œè‰²
                    pixels[pos] = fillR;
                    pixels[pos + 1] = fillG;
                    pixels[pos + 2] = fillB;
                    pixels[pos + 3] = 255; // ä¸é€æ˜
                    
                    // æ·»åŠ ç›¸é‚»åƒç´ 
                    stack.push([x + 1, y]);
                    stack.push([x - 1, y]);
                    stack.push([x, y + 1]);
                    stack.push([x, y - 1]);
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
        }

        // ä¿å­˜ç”»å¸ƒçŠ¶æ€
        function saveCanvasState() {
            // å¦‚æœå½“å‰ä¸æ˜¯æœ€æ–°çš„çŠ¶æ€ï¼Œåˆ é™¤ä¹‹åçš„çŠ¶æ€
            if (historyIndex < canvasHistory.length - 1) {
                canvasHistory = canvasHistory.slice(0, historyIndex + 1);
            }
            
            // ä¿å­˜å½“å‰çŠ¶æ€
            canvasHistory.push(canvas.toDataURL());
            historyIndex = canvasHistory.length - 1;
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (canvasHistory.length > 20) {
                canvasHistory.shift();
                historyIndex--;
            }
        }

        // æ’¤å›åŠŸèƒ½
        function undoLastAction() {
            if (historyIndex > 0) {
                historyIndex--;
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = canvasHistory[historyIndex];
            } else if (historyIndex === 0) {
                // å›åˆ°åˆå§‹çŠ¶æ€
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                historyIndex = -1;
                canvasHistory = [];
            }
        }

        // æäº¤ç»˜åˆ¶ä½œå“
        submitDrawingBtn.addEventListener('click', () => {
            // å°†ç”»å¸ƒå†…å®¹è½¬æ¢ä¸ºå›¾ç‰‡
            const imageData = canvas.toDataURL('image/png');
            
            // åˆ›å»ºæ–°å®¶å…·
            const newFurniture = {
                id: Date.now(),
                type: 'drawing',
                image: imageData,
                name: `æˆ‘çš„åˆ›ä½œ ${userFurniture.length + 1}`,
                description: 'æˆ‘äº²æ‰‹ç»˜åˆ¶çš„å®¶å…·',
                style: 'è‡ªå®šä¹‰'
            };
            
            // æ·»åŠ åˆ°ç”¨æˆ·å®¶å…·åˆ—è¡¨
            userFurniture.push(newFurniture);
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserFurniture();
            updateCounts();
            saveData();
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            submitDrawingBtn.disabled = true;
            
            // é‡ç½®ç»˜åˆ¶ä¸»é¢˜
            currentDrawingTheme = null;
            drawingTheme.textContent = 'è¯·å…ˆæŠ½å–ä¸€ä¸ªç»˜åˆ¶ä¸»é¢˜';
            drawingDesc.textContent = '';
            
            // é‡ç½®å†å²è®°å½•
            canvasHistory = [];
            historyIndex = -1;
            saveCanvasState();
            
            alert('ä½œå“æäº¤æˆåŠŸï¼å·²æ·»åŠ åˆ°ä½ çš„å®¶å…·åº“ä¸­');
        });

        // å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
        imageUpload.addEventListener('change', handleImageUpload);
        
        function handleImageUpload(e) {
            const file = e.target.files[0];
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ2MBï¼‰
            if (file.size > 2 * 1024 * 1024) {
                fileSizeModal.style.display = 'flex';
                imageUpload.value = ''; // æ¸…ç©ºé€‰æ‹©
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
                // åˆ›å»ºå›¾ç‰‡å¯¹è±¡æ¥æ£€æŸ¥å°ºå¯¸
                const img = new Image();
                img.onload = function() {
                    // æ˜¾ç¤ºé¢„è§ˆ
                    uploadPreview.src = event.target.result;
                    uploadPreview.style.display = 'block';
                    uploadActions.style.display = 'block';
                };
                img.src = event.target.result;
            };
            
            reader.readAsDataURL(file);
        }
        
        // å›¾ç‰‡å¤§å°è¶…é™å¼¹çª—
        sizeModalOk.addEventListener('click', () => {
            fileSizeModal.style.display = 'none';
        });

        // ç¡®è®¤ä¸Šä¼ 
        confirmUploadBtn.addEventListener('click', () => {
            // æ˜¾ç¤ºç¡®è®¤å¼¹çª—
            uploadConfirmModal.style.display = 'flex';
        });
        
        // å¼¹çª—ç¡®è®¤
        modalConfirmBtn.addEventListener('click', () => {
            // åˆ›å»ºæ–°å®¶å…·
            const newFurniture = {
                id: Date.now() + 1,
                type: 'upload',
                image: uploadPreview.src,
                name: `ä¸Šä¼ çš„å®¶å…· ${userFurniture.filter(f => f.type === 'upload').length + 1}`,
                description: 'ä¸Šä¼ çš„å›¾ç‰‡å®¶å…·',
                style: 'è‡ªå®šä¹‰'
            };
            
            // æ·»åŠ åˆ°ç”¨æˆ·å®¶å…·åˆ—è¡¨
            userFurniture.push(newFurniture);
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserFurniture();
            updateCounts();
            saveData();
            
            // é‡ç½®ä¸Šä¼ åŒºåŸŸ
            resetUploadArea();
            uploadConfirmModal.style.display = 'none';
            
            alert('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼å·²æ·»åŠ åˆ°ä½ çš„å®¶å…·åº“ä¸­');
        });
        
        // å¼¹çª—å–æ¶ˆ
        modalCancelBtn.addEventListener('click', () => {
            uploadConfirmModal.style.display = 'none';
        });

        // å–æ¶ˆä¸Šä¼ 
        cancelUploadBtn.addEventListener('click', resetUploadArea);
        
        function resetUploadArea() {
            uploadPreview.src = '';
            uploadPreview.style.display = 'none';
            uploadActions.style.display = 'none';
            imageUpload.value = '';
        }

        // æ‰­è›‹åŠŸèƒ½
        gachaBtn.addEventListener('click', startGacha);
        waitingEgg.addEventListener('click', startGacha);

        function startGacha() {
            if (eggs <= 0) {
                alert('ä½ çš„æ‰­è›‹æ•°é‡ä¸è¶³ï¼Œè¯·é€šè¿‡å°æ¸¸æˆè·å–æ›´å¤šæ‰­è›‹');
                return;
            }
            
            // æ¶ˆè€—ä¸€ä¸ªæ‰­è›‹
            eggs--;
            updateCounts();
            
            // æ˜¾ç¤ºåŠ¨ç”»
            waitingEgg.style.display = 'none';
            eggDropContainer.classList.remove('hidden');
            droppingEgg.classList.remove('open');
            
            // åŠ¨ç”»ç»“æŸåæ˜¾ç¤ºç»“æœ
            setTimeout(() => {
                droppingEgg.classList.add('open');
                
                setTimeout(() => {
                    eggDropContainer.classList.add('hidden');
                    resultShow.classList.remove('hidden');
                    
                    // éšæœºè·å–ä¸€ä¸ªå®¶å…·æˆ–è´´çº¸
                    const isSticker = Math.random() > 0.7; // 30%æ¦‚ç‡è·å¾—è´´çº¸
                    
                    if (isSticker) {
                        // éšæœºé€‰æ‹©ä¸€ä¸ªè´´çº¸
                        const stickers = ['ğŸƒ', 'ğŸ‘»', 'ğŸ•·ï¸', 'ğŸ¦‡', 'ğŸ•¸ï¸', 'ğŸ¬', 'ğŸ­', 'ğŸ§™', 'ğŸ•¯ï¸', 'â˜ ï¸', 'ğŸ’€', 'ğŸ”®'];
                        const randomSticker = stickers[Math.floor(Math.random() * stickers.length)];
                        
                        resultContent.innerHTML = `<span style="font-size: 48px;">${randomSticker}</span>`;
                        
                        // æ·»åŠ è´´çº¸
                        stickerCount++;
                        placedStickers.push({
                            id: Date.now(),
                            content: randomSticker,
                            x: window.innerWidth / 2,
                            y: window.innerHeight / 2,
                            rotation: 0,
                            scale: 1
                        });
                        
                        // æ˜¾ç¤ºè·å¾—ç‰©å“å¼¹çª—
                        showRewardModal('è´´çº¸', randomSticker, 'å¯ä»¥åœ¨é¡µé¢ä¸Šä»»æ„æ”¾ç½®çš„è£…é¥°è´´çº¸');
                    } else {
                        // éšæœºé€‰æ‹©ä¸€ä¸ªå®¶å…·
                        const randomFurniture = furnitureData[Math.floor(Math.random() * furnitureData.length)];
                        
                        // æ£€æŸ¥æ˜¯å¦å·²ç»æ‹¥æœ‰
                        const alreadyHave = userFurniture.some(f => f.id === randomFurniture.id);
                        
                        resultContent.innerHTML = `<span style="font-size: 48px;">${randomFurniture.emoji}</span>`;
                        
                        // å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ åˆ°ç”¨æˆ·å®¶å…·
                        if (!alreadyHave) {
                            userFurniture.push({...randomFurniture, type: 'gacha'});
                            furnitureCount++;
                            updateUserFurniture();
                            
                            // æ˜¾ç¤ºè·å¾—ç‰©å“å¼¹çª—
                            showRewardModal('å®¶å…·', randomFurniture.emoji, randomFurniture.name, randomFurniture.description);
                            
                            // è®¾ç½®ç»˜åˆ¶ä¸»é¢˜
                            currentDrawingTheme = randomFurniture;
                            drawingTheme.textContent = `ç»˜åˆ¶ä¸»é¢˜: ${randomFurniture.name}`;
                            drawingDesc.textContent = `æè¿°: ${randomFurniture.description}`;
                        } else {
                            // å·²ç»æ‹¥æœ‰ï¼Œå¥–åŠ±æ‰­è›‹
                            eggs += 2;
                            setTimeout(() => {
                                alert('ä½ å·²ç»æ‹¥æœ‰è¿™ä¸ªå®¶å…·äº†ï¼Œè·å¾—2ä¸ªæ‰­è›‹ä½œä¸ºè¡¥å¿ï¼');
                            }, 1000);
                        }
                    }
                    
                    updateCounts();
                    saveData();
                    
                    // 3ç§’åé‡ç½®
                    setTimeout(() => {
                        resultShow.classList.add('hidden');
                        waitingEgg.style.display = 'flex';
                    }, 3000);
                }, 500);
            }, 1000);
        }

        // æ˜¾ç¤ºè·å¾—ç‰©å“å¼¹çª—
        function showRewardModal(type, icon, name, description = '') {
            rewardIcon.textContent = icon;
            rewardTitle.textContent = `æ­å–œè·å¾—æ–°${type}ï¼`;
            rewardName.textContent = name;
            rewardDescription.textContent = description;
            rewardModal.style.display = 'flex';
        }

        // å…³é—­è·å¾—ç‰©å“å¼¹çª—
        rewardClose.addEventListener('click', () => {
            rewardModal.style.display = 'none';
        });

        // æ›´æ–°è®¡æ•°æ˜¾ç¤º
        function updateCounts() {
            eggCountEl.textContent = eggs;
            furnitureCountEl.textContent = `${furnitureCount}/70`;
            stickerCountEl.textContent = stickerCount;
        }

        // æ›´æ–°ç”¨æˆ·å®¶å…·æ˜¾ç¤º
        function updateUserFurniture() {
            furnitureSelection.innerHTML = '';
            
            if (userFurniture.length === 0) {
                emptyFurniture.style.display = 'block';
                return;
            }
            
            emptyFurniture.style.display = 'none';
            
            userFurniture.forEach(furniture => {
                const furnitureEl = document.createElement('div');
                furnitureEl.className = 'bg-white rounded-lg p-3 text-center cursor-pointer hover:shadow-md transition-shadow';
                furnitureEl.setAttribute('data-id', furniture.id);
                
                if (furniture.type === 'gacha') {
                    furnitureEl.innerHTML = `
                        <div style="font-size: 32px;">${furniture.emoji}</div>
                        <p class="text-sm mt-1">${furniture.name}</p>
                    `;
                } else {
                    furnitureEl.innerHTML = `
                        <img src="${furniture.image}" alt="${furniture.name}" class="w-16 h-16 mx-auto object-contain">
                        <p class="text-sm mt-1">${furniture.name}</p>
                    `;
                }
                
                furnitureEl.addEventListener('click', () => {
                    addFurnitureToRoom(furniture);
                });
                
                furnitureSelection.appendChild(furnitureEl);
            });
        }

        // æ·»åŠ å®¶å…·åˆ°æˆ¿é—´
        function addFurnitureToRoom(furniture) {
            const furnitureEl = document.createElement('div');
            furnitureEl.className = 'room-furniture';
            furnitureEl.style.width = '80px';
            furnitureEl.style.height = '80px';
            furnitureEl.style.left = '50%';
            furnitureEl.style.top = '50%';
            furnitureEl.setAttribute('data-id', furniture.id);
            
            if (furniture.type === 'gacha') {
                furnitureEl.innerHTML = `<div style="font-size: 48px;">${furniture.emoji}</div>`;
            } else {
                furnitureEl.innerHTML = `<img src="${furniture.image}" alt="${furniture.name}" class="furniture-image">`;
            }
            
            furnitureContainer.appendChild(furnitureEl);
            
            // æ·»åŠ æ‹–åŠ¨åŠŸèƒ½
            makeDraggable(furnitureEl);
        }

        // ä½¿å…ƒç´ å¯æ‹–åŠ¨
        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e.preventDefault();
                
                // å¦‚æœæ˜¯åˆ é™¤æ¨¡å¼ï¼Œç›´æ¥åˆ é™¤
                if (currentAction === 'delete') {
                    element.remove();
                    return;
                }
                
                // å¦‚æœæ˜¯æ—‹è½¬æ¨¡å¼
                if (currentAction === 'rotate') {
                    const currentRotation = getRotationDegrees(element);
                    element.style.transform = `rotate(${currentRotation + 45}deg)`;
                    return;
                }
                
                // å¦‚æœæ˜¯ç¼©æ”¾æ¨¡å¼
                if (currentAction === 'scale') {
                    const currentScale = getScale(element);
                    const newScale = currentScale + 0.1;
                    element.style.transform = `scale(${newScale}) rotate(${getRotationDegrees(element)}deg)`;
                    return;
                }
                
                // ç§»åŠ¨æ¨¡å¼
                selectedFurniture = element;
                
                // è·å–é¼ æ ‡åˆå§‹ä½ç½®
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e.preventDefault();
                
                // è®¡ç®—æ–°çš„ä½ç½®
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                // è®¾ç½®å…ƒç´ æ–°çš„ä½ç½®
                const newTop = (element.offsetTop - pos2) + 'px';
                const newLeft = (element.offsetLeft - pos1) + 'px';
                
                // é™åˆ¶åœ¨æˆ¿é—´å†…
                const roomRect = roomContainer.getBoundingClientRect();
                const elemRect = element.getBoundingClientRect();
                
                if (parseInt(newTop) >= 0 && 
                    parseInt(newTop) + elemRect.height <= roomRect.height &&
                    parseInt(newLeft) >= 0 && 
                    parseInt(newLeft) + elemRect.width <= roomRect.width) {
                    
                    element.style.top = newTop;
                    element.style.left = newLeft;
                }
            }
            
            function closeDragElement() {
                // åœæ­¢ç§»åŠ¨
                document.onmouseup = null;
                document.onmousemove = null;
                selectedFurniture = null;
            }
        }

        // è·å–å…ƒç´ æ—‹è½¬è§’åº¦
        function getRotationDegrees(obj) {
            const style = window.getComputedStyle(obj);
            const matrix = new WebKitCSSMatrix(style.transform);
            const angle = Math.round(Math.atan2(matrix.m21, matrix.m11) * (180 / Math.PI));
            return (angle < 0) ? angle + 360 : angle;
        }

        // è·å–å…ƒç´ ç¼©æ”¾æ¯”ä¾‹
        function getScale(obj) {
            const style = window.getComputedStyle(obj);
            const matrix = new WebKitCSSMatrix(style.transform);
            return Math.sqrt(matrix.m11 * matrix.m11 + matrix.m21 * matrix.m21);
        }

        // æˆ¿é—´æ“ä½œæŒ‰é’®
        moveBtn.addEventListener('click', () => setAction('move'));
        rotateBtn.addEventListener('click', () => setAction('rotate'));
        scaleBtn.addEventListener('click', () => setAction('scale'));
        deleteBtn.addEventListener('click', () => setAction('delete'));

        function setAction(action) {
            currentAction = action;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            moveBtn.classList.remove('active');
            rotateBtn.classList.remove('active');
            scaleBtn.classList.remove('active');
            deleteBtn.classList.remove('active');
            
            document.querySelector(`#${action}-btn`).classList.add('active');
        }

        // è´´çº¸åŠŸèƒ½
        stickerItems.forEach(item => {
            item.addEventListener('click', () => {
                currentSticker = item.getAttribute('data-sticker');
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                stickerItems.forEach(i => i.classList.remove('bg-gray-200'));
                item.classList.add('bg-gray-200');
                
                // æç¤ºç”¨æˆ·ç‚¹å‡»æ”¾ç½®
                alert(`å·²é€‰æ‹© ${currentSticker}ï¼Œè¯·åœ¨é¡µé¢ä»»æ„ä½ç½®ç‚¹å‡»æ”¾ç½®`);
                
                // æ·»åŠ ç‚¹å‡»æ”¾ç½®äº‹ä»¶
                document.addEventListener('click', placeSticker);
            });
        });

        function placeSticker(e) {
            // å¿½ç•¥è´´çº¸é€‰æ‹©åŒºåŸŸçš„ç‚¹å‡»
            if (e.target.closest('#sticker-collection')) return;
            
            if (currentSticker) {
                // åˆ›å»ºæ–°è´´çº¸
                const sticker = document.createElement('div');
                sticker.className = 'sticker';
                sticker.textContent = currentSticker;
                sticker.style.left = `${e.clientX}px`;
                sticker.style.top = `${e.clientY}px`;
                sticker.setAttribute('data-id', Date.now());
                
                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(sticker);
                
                // è®°å½•è´´çº¸
                stickerCount++;
                placedStickers.push({
                    id: parseInt(sticker.getAttribute('data-id')),
                    content: currentSticker,
                    x: e.clientX,
                    y: e.clientY,
                    rotation: 0,
                    scale: 1
                });
                
                // æ›´æ–°è®¡æ•°
                updateCounts();
                saveData();
                
                // ä½¿è´´çº¸å¯æ‹–åŠ¨
                makeStickerDraggable(sticker);
                
                // ç§»é™¤äº‹ä»¶ç›‘å¬
                document.removeEventListener('click', placeSticker);
                currentSticker = null;
                
                // é‡ç½®é€‰ä¸­çŠ¶æ€
                stickerItems.forEach(i => i.classList.remove('bg-gray-200'));
            }
        }

        // ä½¿è´´çº¸å¯æ‹–åŠ¨
        function makeStickerDraggable(sticker) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let isDragging = false;
            
            sticker.onmousedown = dragStart;
            sticker.ondblclick = () => {
                sticker.remove();
                // ä»æ•°ç»„ä¸­ç§»é™¤
                placedStickers = placedStickers.filter(s => s.id !== parseInt(sticker.getAttribute('data-id')));
                stickerCount--;
                updateCounts();
                saveData();
            };
            
            function dragStart(e) {
                e.preventDefault();
                isDragging = true;
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = dragEnd;
                document.onmousemove = dragMove;
            }
            
            function dragMove(e) {
                if (!isDragging) return;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                // æ›´æ–°ä½ç½®
                sticker.style.top = (sticker.offsetTop - pos2) + "px";
                sticker.style.left = (sticker.offsetLeft - pos1) + "px";
                
                // æ›´æ–°æ•°ç»„ä¸­çš„ä½ç½®
                const index = placedStickers.findIndex(s => s.id === parseInt(sticker.getAttribute('data-id')));
                if (index !== -1) {
                    placedStickers[index].x = sticker.offsetLeft - pos1;
                    placedStickers[index].y = sticker.offsetTop - pos2;
                }
            }
            
            function dragEnd() {
                isDragging = false;
                document.onmouseup = null;
                document.onmousemove = null;
                saveData();
            }
        }

        // æ¸²æŸ“å®¶å…·æ”¶è—
        function renderFurnitureCollection() {
            collectionGrid.innerHTML = '';
            
            furnitureData.forEach(furniture => {
                const isOwned = userFurniture.some(f => f.id === furniture.id);
                
                const card = document.createElement('div');
                card.className = `bg-white rounded-lg shadow-sm p-3 furniture-card ${isOwned ? '' : 'opacity-50'}`;
                card.setAttribute('data-style', furniture.style);
                
                card.innerHTML = `
                    <div style="font-size: 48px; text-align: center; height: 60px;">${furniture.emoji}</div>
                    <h4 class="font-medium mt-2">${furniture.name}</h4>
                    <p class="text-xs text-gray-500 mt-1">${furniture.description}</p>
                    ${!isOwned ? '<div class="absolute top-2 right-2 text-xs bg-gray-200 px-1 rounded">æœªæ‹¥æœ‰</div>' : ''}
                `;
                
                collectionGrid.appendChild(card);
            });
        }

        // å®¶å…·ç­›é€‰
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const filter = btn.getAttribute('data-filter');
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                filterBtns.forEach(b => {
                    b.classList.remove('bg-gray-700', 'text-white');
                    b.classList.add('bg-white', 'border', 'border-gray-300', 'hover:bg-gray-50');
                });
                btn.classList.remove('bg-white', 'border', 'border-gray-300', 'hover:bg-gray-50');
                btn.classList.add('bg-gray-700', 'text-white');
                
                // ç­›é€‰å®¶å…·
                const cards = document.querySelectorAll('.furniture-card');
                cards.forEach(card => {
                    if (filter === 'all' || card.getAttribute('data-style') === filter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });

        // éŸ³ä¹æ§åˆ¶
        musicControl.addEventListener('click', () => {
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(e => {
                    console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                });
                musicControl.innerHTML = '<i class="fa fa-pause"></i>';
            } else {
                backgroundMusic.pause();
                musicControl.innerHTML = '<i class="fa fa-music"></i>';
            }
        });

        // æ¸¸æˆåˆå§‹åŒ–
        function initGames() {
            // æ¸¸æˆå…¥å£æŒ‰é’®
            gameEnterBtn.addEventListener('click', () => {
                gameContainer.style.display = 'flex';
            });
            
            // æ¸¸æˆå…³é—­æŒ‰é’®
            gameCloseBtn.addEventListener('click', () => {
                gameContainer.style.display = 'none';
            });
            
            // æ¸¸æˆé€‰æ‹©
            gameOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const gameType = option.getAttribute('data-game');
                    gameContainer.style.display = 'none';
                    
                    if (gameType === 'memory') {
                        startMemoryGame();
                    } else if (gameType === 'pumpkin') {
                        startPumpkinGame();
                    }
                });
            });
            
            // è®°å¿†æ¸¸æˆå…³é—­æŒ‰é’®
            memoryCloseBtn.addEventListener('click', () => {
                memoryGameContainer.style.display = 'none';
            });
            
            // å—ç“œæ¸¸æˆå…³é—­æŒ‰é’®
            pumpkinCloseBtn.addEventListener('click', () => {
                pumpkinGameContainer.style.display = 'none';
                stopPumpkinGame();
            });
            
            // æ¸¸æˆç»“æœå…³é—­æŒ‰é’®
            resultCloseBtn.addEventListener('click', () => {
                gameResult.style.display = 'none';
            });
        }

        // è®°å¿†ç¿»ç‰Œæ¸¸æˆ
        function startMemoryGame() {
            memoryGameContainer.style.display = 'flex';
            memoryGame.innerHTML = '';
            flippedCards = [];
            matchedPairs = 0;
            memoryScoreEl.textContent = 'å·²åŒ¹é…: 0/8';
            
            // åˆ›å»ºå¡ç‰‡
            const symbols = ['ğŸƒ', 'ğŸ‘»', 'ğŸ¦‡', 'ğŸ•·ï¸', 'ğŸ¬', 'ğŸ­', 'ğŸ•¸ï¸', 'ğŸ”®'];
            memoryCards = [...symbols, ...symbols];
            
            // éšæœºæ’åº
            memoryCards.sort(() => Math.random() - 0.5);
            
            // åˆ›å»ºå¡ç‰‡å…ƒç´ 
            memoryCards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.innerHTML = `
                    <div class="front">${symbol}</div>
                    <div class="back">?</div>
                `;
                card.addEventListener('click', () => flipCard(card, symbol, index));
                memoryGame.appendChild(card);
            });
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            memoryRestartBtn.addEventListener('click', startMemoryGame);
        }

        function flipCard(card, symbol, index) {
            // å¦‚æœå¡ç‰‡å·²ç»ç¿»å¼€æˆ–åŒ¹é…ï¼Œæˆ–è€…å·²ç»ç¿»å¼€äº†ä¸¤å¼ å¡ç‰‡ï¼Œåˆ™è¿”å›
            if (card.classList.contains('flipped') || flippedCards.length === 2) {
                return;
            }
            
            // ç¿»å¼€å¡ç‰‡
            card.classList.add('flipped');
            flippedCards.push({ card, symbol, index });
            
            // å¦‚æœç¿»å¼€äº†ä¸¤å¼ å¡ç‰‡ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (flippedCards.length === 2) {
                const [card1, card2] = flippedCards;
                
                if (card1.symbol === card2.symbol) {
                    // åŒ¹é…æˆåŠŸ
                    matchedPairs++;
                    memoryScoreEl.textContent = `å·²åŒ¹é…: ${matchedPairs}/8`;
                    flippedCards = [];
                    
                    // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
                    if (matchedPairs === 8) {
                        setTimeout(() => {
                            endMemoryGame();
                        }, 500);
                    }
                } else {
                    // ä¸åŒ¹é…ï¼Œç¿»å›å¡ç‰‡
                    setTimeout(() => {
                        card1.card.classList.remove('flipped');
                        card2.card.classList.remove('flipped');
                        flippedCards = [];
                    }, 1000);
                }
            }
        }

        function endMemoryGame() {
            memoryGameContainer.style.display = 'none';
            
            // è®¡ç®—å¥–åŠ±
            const reward = 3;
            eggs += reward;
            updateCounts();
            saveData();
            
            // æ˜¾ç¤ºç»“æœ
            resultTitle.textContent = 'æ­å–œï¼æ¸¸æˆå®Œæˆï¼';
            gameScoreEl.textContent = 'å¾—åˆ†: 8/8';
            gameRewardEl.textContent = `å¥–åŠ±: ${reward}ä¸ªæ‰­è›‹`;
            gameResult.style.display = 'flex';
        }

        // å—ç“œæ¥ç‰©æ¸¸æˆ
        function startPumpkinGame() {
            pumpkinGameContainer.style.display = 'flex';
            pumpkinScore = 0;
            pumpkinScoreEl.textContent = 'å¾—åˆ†: 0';
            fallingPumpkins = [];
            basketPosition = 150;
            updateBasketPosition();
            
            // å¼€å§‹æŒ‰é’®
            pumpkinStartBtn.addEventListener('click', startPumpkinFall);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            pumpkinRestartBtn.addEventListener('click', () => {
                stopPumpkinGame();
                startPumpkinGame();
            });
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', handleKeyPress);
        }

        function startPumpkinFall() {
            pumpkinGameActive = true;
            pumpkinStartBtn.disabled = true;
            
            // åˆ›å»ºå—ç“œ
            pumpkinInterval = setInterval(() => {
                if (!pumpkinGameActive) return;
                
                const pumpkin = document.createElement('div');
                pumpkin.className = 'falling-pumpkin';
                pumpkin.textContent = 'ğŸƒ';
                pumpkin.style.left = `${Math.random() * 260 + 20}px`;
                pumpkin.style.animationDuration = `${Math.random() * 2 + 2}s`;
                
                pumpkinGame.appendChild(pumpkin);
                fallingPumpkins.push(pumpkin);
                
                // æ£€æŸ¥ç¢°æ’
                const checkInterval = setInterval(() => {
                    if (!pumpkinGameActive) {
                        clearInterval(checkInterval);
                        return;
                    }
                    
                    const pumpkinRect = pumpkin.getBoundingClientRect();
                    const basketRect = document.getElementById('pumpkin-basket').getBoundingClientRect();
                    
                    // æ£€æŸ¥ç¢°æ’
                    if (
                        pumpkinRect.bottom >= basketRect.top &&
                        pumpkinRect.left >= basketRect.left &&
                        pumpkinRect.right <= basketRect.right
                    ) {
                        // æ¥ä½å—ç“œ
                        pumpkin.remove();
                        fallingPumpkins = fallingPumpkins.filter(p => p !== pumpkin);
                        pumpkinScore++;
                        pumpkinScoreEl.textContent = `å¾—åˆ†: ${pumpkinScore}`;
                        clearInterval(checkInterval);
                    } else if (pumpkinRect.bottom >= pumpkinGame.getBoundingClientRect().bottom) {
                        // å—ç“œè½åœ°
                        pumpkin.remove();
                        fallingPumpkins = fallingPumpkins.filter(p => p !== pumpkin);
                        clearInterval(checkInterval);
                        
                        // æ¸¸æˆç»“æŸ
                        if (pumpkinGameActive) {
                            endPumpkinGame();
                        }
                    }
                }, 50);
                
                // 5ç§’åç§»é™¤å—ç“œï¼ˆå¦‚æœè¿˜æ²¡è¢«æ¥ä½æˆ–è½åœ°ï¼‰
                setTimeout(() => {
                    if (pumpkin.parentNode) {
                        pumpkin.remove();
                        fallingPumpkins = fallingPumpkins.filter(p => p !== pumpkin);
                    }
                }, 5000);
            }, 1000);
        }

        function stopPumpkinGame() {
            pumpkinGameActive = false;
            clearInterval(pumpkinInterval);
            
            // ç§»é™¤æ‰€æœ‰å—ç“œ
            fallingPumpkins.forEach(pumpkin => {
                if (pumpkin.parentNode) {
                    pumpkin.remove();
                }
            });
            fallingPumpkins = [];
            
            // ç§»é™¤äº‹ä»¶ç›‘å¬
            document.removeEventListener('keydown', handleKeyPress);
        }

        function handleKeyPress(e) {
            if (!pumpkinGameActive) return;
            
            if (e.key === 'ArrowLeft') {
                basketPosition = Math.max(0, basketPosition - 20);
                updateBasketPosition();
            } else if (e.key === 'ArrowRight') {
                basketPosition = Math.min(280, basketPosition + 20);
                updateBasketPosition();
            }
        }

        function updateBasketPosition() {
            document.getElementById('pumpkin-basket').style.left = `${basketPosition}px`;
        }

        function endPumpkinGame() {
            stopPumpkinGame();
            pumpkinGameContainer.style.display = 'none';
            
            // è®¡ç®—å¥–åŠ±
            const reward = Math.floor(pumpkinScore / 10);
            eggs += reward;
            updateCounts();
            saveData();
            
            // æ˜¾ç¤ºç»“æœ
            resultTitle.textContent = 'æ¸¸æˆç»“æŸï¼';
            gameScoreEl.textContent = `å¾—åˆ†: ${pumpkinScore}`;
            gameRewardEl.textContent = `å¥–åŠ±: ${reward}ä¸ªæ‰­è›‹`;
            gameResult.style.display = 'flex';
        }

        // æ•°æ®å­˜å‚¨åŠŸèƒ½
        function saveData() {
            const data = {
                eggs,
                furnitureCount,
                stickerCount,
                userFurniture,
                placedStickers
            };
            
            localStorage.setItem('halloweenCabinData', JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem('halloweenCabinData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                eggs = data.eggs || 10;
                furnitureCount = data.furnitureCount || 0;
                stickerCount = data.stickerCount || 0;
                userFurniture = data.userFurniture || [];
                placedStickers = data.placedStickers || [];
                
                // æ¢å¤æ”¾ç½®çš„è´´çº¸
                placedStickers.forEach(sticker => {
                    const stickerEl = document.createElement('div');
                    stickerEl.className = 'sticker';
                    stickerEl.textContent = sticker.content;
                    stickerEl.style.left = `${sticker.x}px`;
                    stickerEl.style.top = `${sticker.y}px`;
                    stickerEl.style.transform = `rotate(${sticker.rotation}deg) scale(${sticker.scale})`;
                    stickerEl.setAttribute('data-id', sticker.id);
                    
                    document.body.appendChild(stickerEl);
                    makeStickerDraggable(stickerEl);
                });
                
                // æ›´æ–°ç”¨æˆ·å®¶å…·æ˜¾ç¤º
                updateUserFurniture();
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>